<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecteur Radio Pro - JunTech Electronics DG</title>

    <style>
        :root {
            --bg: #111b21;
            --card-bg: #202c33;
            --accent: #00a884;
            --accent-dark: #00876b;
            --text: #e9edef;
            --subtext: #8696a0;
            --danger: #f15b5b;
            --warning: #f1c45b;
            --success: #5bf15b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            background: radial-gradient(circle at top, #202c33 0, #111b21 45%, #000 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .player-container {
            width: 100%;
            max-width: 480px;
            background: rgba(16, 27, 33, 0.96);
            border-radius: 24px;
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.55);
            padding: 18px 18px 22px;
            border: 1px solid rgba(134, 150, 160, 0.25);
            backdrop-filter: blur(10px);
        }

        .header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: #0b141a;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 1px solid rgba(134, 150, 160, 0.4);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .titles {
            flex: 1;
        }

        .titles h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .titles p {
            font-size: 12px;
            color: var(--subtext);
            margin-top: 2px;
        }

        .status-pill {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 999px;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
        }

        .status-pill.live {
            border-color: var(--accent);
            color: var(--accent);
        }

        .status-pill.error {
            border-color: var(--danger);
            color: var(--danger);
        }

        .status-pill.warning {
            border-color: var(--warning);
            color: var(--warning);
        }

        .status-pill.success {
            border-color: var(--success);
            color: var(--success);
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 12px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
            color: var(--subtext);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .action-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .action-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .station-info {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
        }

        .station-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 4px;
        }

        .station-name {
            font-size: 13px;
            color: var(--text);
            font-weight: 600;
            min-height: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .station-description {
            font-size: 11px;
            color: var(--subtext);
            margin-top: 2px;
        }

        .track-info {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
        }

        .track-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-title {
            font-size: 12px;
            color: var(--text);
            font-weight: 500;
            min-height: 16px;
        }

        .track-artist {
            font-size: 11px;
            color: var(--subtext);
            margin-top: 2px;
        }

        .stats-row {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            font-size: 10px;
            color: var(--subtext);
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 4px;
            background: rgba(11, 20, 26, 0.5);
            border-radius: 6px;
        }

        .visualizer {
            margin-bottom: 12px;
            padding: 8px 10px;
            border-radius: 16px;
            background: #0b141a;
            border: 1px solid rgba(134, 150, 160, 0.3);
        }

        .visualizer-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viz-controls {
            display: flex;
            gap: 6px;
        }

        .viz-btn {
            background: transparent;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .viz-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .viz-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        canvas {
            width: 100%;
            height: 48px;
            display: block;
            background: #0b141a;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .play-btn {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: none;
            background: var(--accent);
            color: #fff;
            font-size: 26px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 18px rgba(0, 168, 132, 0.55);
            transition: background 0.15s, transform 0.08s, box-shadow 0.15s;
        }

        .play-btn:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
        }

        .play-btn:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 4px 10px rgba(0, 168, 132, 0.4);
        }

        .secondary-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .secondary-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 12px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
            color: var(--subtext);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .secondary-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .volume-block {
            flex: 1;
        }

        .volume-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .volume-block input[type="range"] {
            width: 100%;
        }

        .equalizer-block {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
            transition: all 0.3s ease;
        }

        .equalizer-block.collapsed {
            height: 40px;
            overflow: hidden;
        }

        .equalizer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .equalizer-label {
            font-size: 11px;
            color: var(--subtext);
        }

        .equalizer-toggle {
            background: transparent;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .equalizer-toggle:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .equalizer-controls {
            display: flex;
            gap: 4px;
            justify-content: space-between;
        }

        .eq-slider {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 0;
        }

        .eq-slider label {
            font-size: 7px;
            color: var(--subtext);
            margin-bottom: 4px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .eq-slider input[type="range"] {
            writing-mode: bt-lr;
            -webkit-appearance: slider-vertical;
            width: 5px;
            height: 50px;
        }

        .eq-value {
            font-size: 7px;
            color: var(--subtext);
            margin-top: 4px;
            min-height: 10px;
        }

        .presets-block {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
        }

        .presets-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 8px;
        }

        .presets-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(134, 150, 160, 0.4);
            background: transparent;
            color: var(--subtext);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .preset-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .preset-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        .recording-block {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
            transition: all 0.3s ease;
        }

        .recording-block.collapsed {
            height: 40px;
            overflow: hidden;
        }

        .recording-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .recording-label {
            font-size: 11px;
            color: var(--subtext);
        }

        .recording-toggle {
            background: transparent;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .recording-toggle:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .recordings-btn {
            background: transparent;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.15s;
            margin-left: 6px;
        }

        .recordings-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .recording-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .record-btn {
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid var(--danger);
            background: transparent;
            color: var(--danger);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .record-btn:hover {
            background: rgba(241, 91, 91, 0.1);
        }

        .record-btn.recording {
            background: var(--danger);
            color: #fff;
        }

        .timer {
            font-size: 11px;
            color: var(--subtext);
        }

        .sleep-timer-block {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 14px;
            background: #111b21;
            border: 1px solid rgba(134, 150, 160, 0.35);
            transition: all 0.3s ease;
        }

        .sleep-timer-block.collapsed {
            height: 40px;
            overflow: hidden;
        }

        .sleep-timer-label {
            font-size: 11px;
            color: var(--subtext);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sleep-timer-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .sleep-timer-btn {
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid var(--warning);
            background: transparent;
            color: var(--warning);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .sleep-timer-btn:hover {
            background: rgba(241, 196, 91, 0.1);
        }

        .sleep-timer-btn.active {
            background: var(--warning);
            color: #111b21;
        }

        .sleep-timer-display {
            font-size: 11px;
            color: var(--subtext);
        }

        .sleep-timer-toggle {
            background: transparent;
            border: 1px solid rgba(134, 150, 160, 0.4);
            color: var(--subtext);
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.15s;
            margin-left: 6px;
        }

        .sleep-timer-toggle:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .recordings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .recordings-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .recordings-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 12px;
        }

        .recordings-title {
            font-size: 14px;
            font-weight: 600;
        }

        .close-recordings {
            background: transparent;
            border: none;
            color: var(--subtext);
            font-size: 18px;
            cursor: pointer;
        }

        .recordings-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .recording-item {
            padding: 8px 12px;
            background: #111b21;
            border-radius: 8px;
            border: 1px solid rgba(134, 150, 160, 0.3);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recording-info {
            flex: 1;
        }

        .recording-name {
            font-size: 11px;
            color: var(--text);
            word-break: break-all;
        }

        .recording-date {
            font-size: 9px;
            color: var(--subtext);
            margin-top: 2px;
        }

        .recording-actions {
            display: flex;
            gap: 8px;
        }

        .action-icon {
            background: transparent;
            border: none;
            color: var(--accent);
            font-size: 14px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .action-icon:hover {
            background: rgba(0, 168, 132, 0.1);
        }

        .download-info {
            font-size: 9px;
            color: var(--subtext);
            margin-top: 8px;
            text-align: center;
            padding: 4px;
            background: rgba(11, 20, 26, 0.5);
            border-radius: 6px;
        }

        .footer-status {
            margin-top: 8px;
            font-size: 11px;
            color: var(--subtext);
            display: flex;
            justify-content: space-between;
            gap: 6px;
        }

        .footer-status span {
            min-width: 0;
        }

        .status-main {
            font-weight: 500;
        }

        .bitrate-display {
            font-size: 10px;
            color: var(--subtext);
        }

        @media (max-width: 380px) {
            .player-container {
                padding: 14px 12px 16px;
                border-radius: 18px;
            }
            .header {
                gap: 10px;
            }
            .logo {
                width: 50px;
                height: 50px;
            }
            .equalizer-controls {
                gap: 3px;
            }
            .eq-slider input[type="range"] {
                height: 45px;
            }
            .quick-actions {
                flex-wrap: wrap;
            }
            .action-btn {
                flex: 1 1 calc(50% - 4px);
                min-width: 0;
            }
        }
    </style>
</head>
<body>

<div class="player-container">
    <div class="header">
        <div class="logo">
            <img src="https://jtebroadcast.net/s/juntech_logo.png" alt="JunTech Electronics DG">
        </div>
        <div class="titles">
            <h1>WebRadio JunTech</h1>
            <p>Propuls√©e par JunTechWare</p>
        </div>
        <div class="status-pill" id="status-pill">En attente</div>
    </div>

    <div class="quick-actions">
        <button class="action-btn" id="favoriteBtn" title="Ajouter aux favoris">
            <span>‚òÖ</span> Favori
        </button>
        <button class="action-btn" id="shareBtn" title="Partager ce flux">
            <span>‚Üó</span> Partager
        </button>
        <button class="action-btn" id="statsBtn" title="Statistiques d√©taill√©es">
            <span>üìä</span> Stats
        </button>
    </div>

    <div class="station-info">
        <div class="station-label">Station Radio</div>
        <div class="station-name" id="stationName">
            <span>üìª</span>
            <span id="stationNameText">Radio JunTech</span>
        </div>
        <div class="station-description" id="stationDescription">
            Votre webradio JunTech - Musique en continu
        </div>
    </div>

    <div class="track-info">
        <div class="track-label">
            <span>En cours de lecture</span>
            <span id="listenersCount">üë• 0</span>
        </div>
        <div class="track-title" id="trackTitle">Chargement...</div>
        <div class="track-artist" id="trackArtist"></div>
        <div class="stats-row">
            <div class="stat-item" id="bitrateStat">Bitrate: -</div>
            <div class="stat-item" id="bufferStat">Buffer: -</div>
            <div class="stat-item" id="qualityStat">Qualit√©: -</div>
        </div>
    </div>

    <div class="visualizer">
        <div class="visualizer-label">
            <span>Visualiseur audio</span>
            <div class="viz-controls">
                <button class="viz-btn active" data-viz="bars">Barres</button>
                <button class="viz-btn" data-viz="wave">Onde</button>
                <button class="viz-btn" data-viz="circle">Cercle</button>
                <button class="viz-btn" data-viz="spectrum">Spectre</button>
            </div>
        </div>
        <canvas id="vizCanvas"></canvas>
    </div>

    <div class="controls">
        <button class="play-btn" id="playBtn">‚ñ∂</button>

        <div class="volume-block">
            <div class="volume-label">
                <span>Volume</span>
                <span id="volumeValue">100%</span>
            </div>
            <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
        </div>
    </div>

    <div class="secondary-controls">
        <button class="secondary-btn" id="muteBtn" title="Couper le son">
            <span>üîá</span> Mute
        </button>
        <button class="secondary-btn" id="replayBtn" title="Red√©marrer le flux">
            <span>‚Üª</span> Replay
        </button>
        <button class="secondary-btn" id="boostBtn" title="Boost des basses">
            <span>üîä</span> Bass Boost
        </button>
    </div>

    <div class="equalizer-block" id="equalizerBlock">
        <div class="equalizer-header">
            <div class="equalizer-label">√âgaliseur 9 Bandes</div>
            <button class="equalizer-toggle" id="eqToggle">Masquer</button>
        </div>
        <div class="equalizer-controls">
            <div class="eq-slider">
                <label for="eqSub">32Hz</label>
                <input id="eqSub" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqSubValue">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqLow1">64Hz</label>
                <input id="eqLow1" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqLow1Value">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqLow2">125Hz</label>
                <input id="eqLow2" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqLow2Value">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqLowMid">250Hz</label>
                <input id="eqLowMid" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqLowMidValue">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqMid">500Hz</label>
                <input id="eqMid" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqMidValue">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqHighMid1">1kHz</label>
                <input id="eqHighMid1" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqHighMid1Value">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqHighMid2">2kHz</label>
                <input id="eqHighMid2" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqHighMid2Value">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqHigh1">4kHz</label>
                <input id="eqHigh1" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqHigh1Value">0dB</div>
            </div>
            <div class="eq-slider">
                <label for="eqHigh2">8kHz</label>
                <input id="eqHigh2" type="range" min="-12" max="12" value="0" step="0.5" orient="vertical">
                <div class="eq-value" id="eqHigh2Value">0dB</div>
            </div>
        </div>
    </div>

    <div class="presets-block">
        <div class="presets-label">Pr√©s√©lections d'√©galiseur</div>
        <div class="presets-buttons">
            <button class="preset-btn" data-preset="flat">Plat</button>
            <button class="preset-btn" data-preset="bass">Basses</button>
            <button class="preset-btn" data-preset="treble">Aigus</button>
            <button class="preset-btn" data-preset="vocal">Voix</button>
            <button class="preset-btn" data-preset="rock">Rock</button>
            <button class="preset-btn" data-preset="jazz">Jazz</button>
            <button class="preset-btn" data-preset="classical">Classique</button>
            <button class="preset-btn" data-preset="electronic">J-Mulhare</button>
        </div>
    </div>

    <div class="sleep-timer-block" id="sleepTimerBlock">
        <div class="sleep-timer-label">
            <span>Minuterie de veille</span>
            <div>
                <button class="sleep-timer-toggle" id="sleepTimerToggle">Masquer</button>
            </div>
        </div>
        <div class="sleep-timer-controls">
            <button class="sleep-timer-btn" data-minutes="15">15 min</button>
            <button class="sleep-timer-btn" data-minutes="30">30 min</button>
            <button class="sleep-timer-btn" data-minutes="60">60 min</button>
            <button class="sleep-timer-btn" id="stopSleepTimer">Arr√™ter</button>
        </div>
        <div class="sleep-timer-display" id="sleepTimerDisplay">D√©sactiv√©e</div>
    </div>

    <div class="recording-block" id="recordingBlock">
        <div class="recording-header">
            <div class="recording-label">Enregistrement audio</div>
            <div>
                <button class="recordings-btn" id="recordingsBtn">Mes enregistrements</button>
                <button class="recording-toggle" id="recordingToggle">Masquer</button>
            </div>
        </div>
        <div class="recording-controls">
            <button class="record-btn" id="recordBtn">‚óè Enregistrer</button>
            <div class="timer" id="recordTimer">00:00</div>
        </div>
        <div class="download-info">
            üìÅ Les enregistrements sont sauvegard√©s dans votre dossier "T√©l√©chargements"
        </div>
    </div>

    <div class="footer-status">
        <span class="status-main" id="statusText">Pr√™t √† √©couter Radio JunTech</span>
        <span id="metaText">https://webradiojte.ngrok.app/stream</span>
        <span class="bitrate-display" id="bitrateDisplay">- kbps</span>
    </div>

    <audio id="radio" preload="none" crossorigin="anonymous"></audio>
</div>

<!-- Modal Enregistrements -->
<div class="recordings-modal" id="recordingsModal">
    <div class="recordings-content">
        <div class="recordings-header">
            <div class="recordings-title">Mes enregistrements</div>
            <button class="close-recordings" id="closeRecordings">&times;</button>
        </div>
        <div class="recordings-list" id="recordingsList">
            <!-- Les enregistrements seront ajout√©s ici -->
        </div>
    </div>
</div>

<script>
    const DEFAULT_RADIO_URL = "https://webradiojte.ngrok.app/stream";

    // √âl√©ments DOM
    const audio = document.getElementById('radio');
    const playBtn = document.getElementById('playBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');
    const statusText = document.getElementById('statusText');
    const statusPill = document.getElementById('status-pill');
    const bitrateDisplay = document.getElementById('bitrateDisplay');
    const vizButtons = document.querySelectorAll('.viz-btn');
    const recordBtn = document.getElementById('recordBtn');
    const recordTimer = document.getElementById('recordTimer');
    const eqToggle = document.getElementById('eqToggle');
    const equalizerBlock = document.getElementById('equalizerBlock');
    const trackTitle = document.getElementById('trackTitle');
    const trackArtist = document.getElementById('trackArtist');
    const recordingsBtn = document.getElementById('recordingsBtn');
    const recordingsModal = document.getElementById('recordingsModal');
    const closeRecordings = document.getElementById('closeRecordings');
    const recordingsList = document.getElementById('recordingsList');
    const recordingToggle = document.getElementById('recordingToggle');
    const recordingBlock = document.getElementById('recordingBlock');
    const favoriteBtn = document.getElementById('favoriteBtn');
    const shareBtn = document.getElementById('shareBtn');
    const statsBtn = document.getElementById('statsBtn');
    const muteBtn = document.getElementById('muteBtn');
    const replayBtn = document.getElementById('replayBtn');
    const boostBtn = document.getElementById('boostBtn');
    const sleepTimerBtns = document.querySelectorAll('.sleep-timer-btn');
    const stopSleepTimer = document.getElementById('stopSleepTimer');
    const sleepTimerDisplay = document.getElementById('sleepTimerDisplay');
    const sleepTimerToggle = document.getElementById('sleepTimerToggle');
    const sleepTimerBlock = document.getElementById('sleepTimerBlock');
    const listenersCount = document.getElementById('listenersCount');
    const bitrateStat = document.getElementById('bitrateStat');
    const bufferStat = document.getElementById('bufferStat');
    const qualityStat = document.getElementById('qualityStat');
    const stationNameText = document.getElementById('stationNameText');
    const stationDescription = document.getElementById('stationDescription');

    // √âgaliseur 9 bandes
    const eqSub = document.getElementById('eqSub');
    const eqLow1 = document.getElementById('eqLow1');
    const eqLow2 = document.getElementById('eqLow2');
    const eqLowMid = document.getElementById('eqLowMid');
    const eqMid = document.getElementById('eqMid');
    const eqHighMid1 = document.getElementById('eqHighMid1');
    const eqHighMid2 = document.getElementById('eqHighMid2');
    const eqHigh1 = document.getElementById('eqHigh1');
    const eqHigh2 = document.getElementById('eqHigh2');
    
    // Affichage des valeurs
    const eqSubValue = document.getElementById('eqSubValue');
    const eqLow1Value = document.getElementById('eqLow1Value');
    const eqLow2Value = document.getElementById('eqLow2Value');
    const eqLowMidValue = document.getElementById('eqLowMidValue');
    const eqMidValue = document.getElementById('eqMidValue');
    const eqHighMid1Value = document.getElementById('eqHighMid1Value');
    const eqHighMid2Value = document.getElementById('eqHighMid2Value');
    const eqHigh1Value = document.getElementById('eqHigh1Value');
    const eqHigh2Value = document.getElementById('eqHigh2Value');

    const presetButtons = document.querySelectorAll('.preset-btn');

    // Variables globales
    let audioCtx, analyser, sourceNode, eqNodes = [];
    let mediaRecorder, recordedChunks = [], recordingStartTime;
    let vizType = 'bars';
    let animationId;
    let smoothing = 0.8;
    let currentMetadata = { title: '', artist: '' };
    let metadataInterval;
    let sleepTimer = null;
    let isMuted = false;
    let originalVolume = 1;
    let isBassBoost = false;
    let recordTimerInterval;

    // Variables pour le canvas
    const canvas = document.getElementById('vizCanvas');
    const ctx = canvas.getContext('2d');

    // Variables d'animation pour l'onde
    let wavePhase = 0;

    // Stockage compatible Android
    let androidStorage = {
        getItem: function(key) {
            try {
                if (typeof localStorage !== 'undefined') {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                }
            } catch (e) {
                console.log('localStorage non disponible');
            }
            return this[key] || null;
        },
        setItem: function(key, value) {
            try {
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem(key, JSON.stringify(value));
                    return;
                }
            } catch (e) {
                console.log('localStorage non disponible');
            }
            this[key] = value;
        }
    };

    let recordingsHistory = androidStorage.getItem('radio_recordings') || [];

    // --- INITIALISATION RADIO JUNTECH ---
    function initializeRadio() {
        // Configurer la source audio avec l'URL par d√©faut
        audio.src = DEFAULT_RADIO_URL;
        
        // Mettre √† jour le statut
        setStatus("Radio JunTech pr√™te √† √©couter", "success");
        
        // D√©marrer la r√©cup√©ration des m√©tadonn√©es
        startMetadataPolling();
        
        // Configurer les informations de la station
        updateStationInfo({
            name: "Radio JunTech",
            description: "Votre webradio JunTech - Musique en continu",
            genre: "Divers",
            bitrate: 128
        });
    }

    // --- FONCTIONS D'ENREGISTREMENT ---
    function startRecording() {
        if (!audio.src) {
            setStatus("Aucune source audio √† enregistrer", "error");
            return;
        }
        
        try {
            recordedChunks = [];
            const stream = audio.captureStream ? audio.captureStream() : null;
            
            if (!stream) {
                setStatus("Enregistrement non support√©", "error");
                return;
            }
            
            const options = {
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 128000
            };
            
            mediaRecorder = new MediaRecorder(stream, options);
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) {
                    recordedChunks.push(e.data);
                }
            };
            
            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                saveRecording(blob);
            };
            
            mediaRecorder.start(1000);
            recordingStartTime = Date.now();
            recordBtn.classList.add('recording');
            recordBtn.textContent = '‚ñ† Arr√™ter';
            
            updateRecordTimer();
            recordTimerInterval = setInterval(updateRecordTimer, 1000);
            
            setStatus("Enregistrement en cours", "live");
        } catch (e) {
            console.error("Erreur enregistrement:", e);
            setStatus("Erreur d'enregistrement", "error");
        }
    }

    function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            recordBtn.classList.remove('recording');
            recordBtn.textContent = '‚óè Enregistrer';
            
            if (recordTimerInterval) {
                clearInterval(recordTimerInterval);
            }
            
            setStatus("Enregistrement termin√©", "success");
        }
    }

    function saveRecording(blob) {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const filename = `Radio_JunTech_${timestamp}.webm`;
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.style.display = 'none';
        
        document.body.appendChild(a);
        a.click();
        
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
        
        const recording = {
            id: Date.now(),
            name: filename,
            date: new Date().toISOString(),
            size: blob.size,
            url: url
        };
        
        recordingsHistory.unshift(recording);
        
        if (recordingsHistory.length > 20) {
            recordingsHistory = recordingsHistory.slice(0, 20);
        }
        
        androidStorage.setItem('radio_recordings', recordingsHistory);
        updateRecordingsList();
        
        setStatus(`Enregistrement sauvegard√©: ${filename}`, "success");
    }

    function updateRecordingsList() {
        recordingsList.innerHTML = '';
        
        if (recordingsHistory.length === 0) {
            recordingsList.innerHTML = '<div class="recording-item">Aucun enregistrement</div>';
            return;
        }
        
        recordingsHistory.forEach(recording => {
            const recordingItem = document.createElement('div');
            recordingItem.className = 'recording-item';
            
            const fileSize = (recording.size / (1024 * 1024)).toFixed(2);
            const date = new Date(recording.date).toLocaleString();
            
            recordingItem.innerHTML = `
                <div class="recording-info">
                    <div class="recording-name">${recording.name}</div>
                    <div class="recording-date">${date} ‚Ä¢ ${fileSize} MB</div>
                </div>
                <div class="recording-actions">
                    <button class="action-icon" title="T√©l√©charger √† nouveau" onclick="downloadRecording('${recording.id}')">üì•</button>
                    <button class="action-icon" title="Partager" onclick="shareRecording('${recording.id}')">‚Üó</button>
                    <button class="action-icon" title="Supprimer" onclick="deleteRecording('${recording.id}')">üóë</button>
                </div>
            `;
            
            recordingsList.appendChild(recordingItem);
        });
    }

    function downloadRecording(recordingId) {
        const recording = recordingsHistory.find(r => r.id == recordingId);
        if (recording) {
            const a = document.createElement('a');
            a.href = recording.url;
            a.download = recording.name;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
            }, 100);
            setStatus("T√©l√©chargement d√©marr√©", "success");
        }
    }

    async function shareRecording(recordingId) {
        const recording = recordingsHistory.find(r => r.id == recordingId);
        if (recording && recording.url) {
            try {
                const response = await fetch(recording.url);
                const blob = await response.blob();
                const file = new File([blob], recording.name, { type: 'audio/webm' });
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        title: 'Enregistrement Radio JunTech',
                        text: `Enregistrement du ${new Date(recording.date).toLocaleString()}`,
                        files: [file]
                    });
                    setStatus("Enregistrement partag√© avec succ√®s", "success");
                } else {
                    navigator.clipboard.writeText(`Enregistrement Radio: ${recording.name}`).then(() => {
                        setStatus("Lien copi√© dans le presse-papier", "success");
                    });
                }
            } catch (error) {
                console.error('Erreur partage:', error);
                setStatus("Erreur lors du partage", "error");
            }
        }
    }

    function deleteRecording(recordingId) {
        if (confirm("Voulez-vous vraiment supprimer cet enregistrement ?")) {
            recordingsHistory = recordingsHistory.filter(r => r.id != recordingId);
            androidStorage.setItem('radio_recordings', recordingsHistory);
            updateRecordingsList();
            setStatus("Enregistrement supprim√©", "success");
        }
    }

    function updateRecordTimer() {
        if (!recordingStartTime) return;
        
        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        
        recordTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // --- FONCTIONNALIT√âS DE MASQUAGE ---
    function toggleSection(section, toggleBtn, storageKey) {
        if (section.classList.contains('collapsed')) {
            section.classList.remove('collapsed');
            toggleBtn.textContent = 'Masquer';
            androidStorage.setItem(storageKey, true);
        } else {
            section.classList.add('collapsed');
            toggleBtn.textContent = 'Afficher';
            androidStorage.setItem(storageKey, false);
        }
    }

    // --- FONCTIONS RADIO ---
    function updateStationInfo(stationData) {
        if (stationData && stationData.name) {
            stationNameText.textContent = stationData.name;
            stationDescription.textContent = stationData.description;
        }
    }

    function startMetadataPolling() {
        if (metadataInterval) {
            clearInterval(metadataInterval);
        }
        
        metadataInterval = setInterval(async () => {
            if (!audio.src || audio.paused) return;
            
            try {
                // R√©cup√©ration des m√©tadonn√©es Icecast
                await fetchIcecastMetadata();
            } catch (error) {
                console.log("Impossible de r√©cup√©rer les m√©tadonn√©es Icecast:", error);
                // Tentative de r√©cup√©ration via l'API Shoutcast
                try {
                    await fetchShoutcastMetadata();
                } catch (error2) {
                    console.log("Impossible de r√©cup√©rer les m√©tadonn√©es Shoutcast:", error2);
                    // M√©tadonn√©es par d√©faut si impossible de r√©cup√©rer
                    updateTrackInfo("Radio JunTech - Musique en continu", "JunTech Electronics");
                }
            }
        }, 10000);
    }

    async function fetchIcecastMetadata() {
        try {
            const statusUrl = DEFAULT_RADIO_URL.replace('/stream', '/status-json.xsl');
            const response = await fetch(statusUrl);
            
            if (response.ok) {
                const data = await response.json();
                updateTrackInfoFromIcecast(data);
                return true;
            }
        } catch (error) {
            throw error;
        }
        return false;
    }

    async function fetchShoutcastMetadata() {
        try {
            // Tentative de r√©cup√©ration des m√©tadonn√©es Shoutcast
            const response = await fetch(DEFAULT_RADIO_URL, { method: 'GET' });
            const headers = response.headers;
            
            // V√©rifier les en-t√™tes typiques de Shoutcast
            const icyName = headers.get('icy-name');
            const icyDescription = headers.get('icy-description');
            const icyGenre = headers.get('icy-genre');
            
            if (icyName) {
                updateStationInfo({
                    name: icyName,
                    description: icyDescription || "Station radio en ligne",
                    genre: icyGenre || "Divers"
                });
                
                // Pour Shoutcast, les m√©tadonn√©es de titre sont g√©n√©ralement dans le flux
                // On ne peut pas les r√©cup√©rer facilement via HTTP
                updateTrackInfo("Lecture en cours", icyName);
                return true;
            }
        } catch (error) {
            throw error;
        }
        return false;
    }

    function updateTrackInfoFromIcecast(icecastData) {
        try {
            if (icecastData && icecastData.icestats && icecastData.icestats.source) {
                const source = icecastData.icestats.source;
                
                // Mettre √† jour le nom de la station
                if (source.server_name) {
                    updateStationInfo({
                        name: source.server_name,
                        description: source.server_description || "Station radio en ligne",
                        genre: source.genre || "Divers"
                    });
                }
                
                // Mettre √† jour les informations de piste
                let title = source.title || "Radio JunTech - Musique en continu";
                let artist = source.artist || "JunTech Electronics";
                
                updateTrackInfo(title, artist);
            }
        } catch (error) {
            updateTrackInfo("Radio JunTech - Musique en continu", "JunTech Electronics");
        }
    }

    function updateTrackInfo(title, artist = '') {
        currentMetadata = { title, artist };
        
        trackTitle.textContent = title;
        trackArtist.textContent = artist;
        
        trackArtist.style.display = artist ? 'block' : 'none';
    }

    function setStatus(text, type = "normal") {
        statusText.textContent = text;
        statusPill.textContent = text;

        statusPill.classList.remove("live", "error", "warning", "success");
        if (type === "live") statusPill.classList.add("live");
        if (type === "error") statusPill.classList.add("error");
        if (type === "warning") statusPill.classList.add("warning");
        if (type === "success") statusPill.classList.add("success");
    }

    function togglePlay() {
        if (!audio.src) {
            setStatus("Aucune source audio configur√©e", "error");
            return;
        }
        
        if (audio.paused) {
            audio.play().then(() => {
                setStatus("Lecture en cours - Radio JunTech", "live");
                playBtn.textContent = "‚ùö‚ùö";
                initAudioContext();
                startVisualizer();
                updateConnectionStats();
                
                // Tentative de r√©cup√©ration imm√©diate des m√©tadonn√©es
                setTimeout(() => {
                    fetchIcecastMetadata().catch(() => {
                        fetchShoutcastMetadata().catch(() => {
                            console.log("Utilisation des m√©tadonn√©es par d√©faut");
                        });
                    });
                }, 1000);
            }).catch(e => {
                console.error("Erreur de lecture:", e);
                setStatus("Erreur de connexion √† Radio JunTech", "error");
            });
        } else {
            audio.pause();
            setStatus("Lecture en pause", "warning");
            playBtn.textContent = "‚ñ∂";
            stopVisualizer();
        }
    }

    function initAudioContext() {
        if (audioCtx) return;
        
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            sourceNode = audioCtx.createMediaElementSource(audio);
            
            analyser.fftSize = 256;
            analyser.smoothingTimeConstant = smoothing;
            
            sourceNode.connect(analyser);
            analyser.connect(audioCtx.destination);
            
            initEqualizer();
        } catch (e) {
            console.error("Erreur initialisation AudioContext:", e);
        }
    }

    function initEqualizer() {
        if (!audioCtx) return;
        
        eqNodes.forEach(node => node.disconnect());
        eqNodes = [];
        
        const frequencies = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000];
        const eqSliders = [eqSub, eqLow1, eqLow2, eqLowMid, eqMid, eqHighMid1, eqHighMid2, eqHigh1, eqHigh2];
        
        let lastNode = sourceNode;
        
        frequencies.forEach((freq, index) => {
            const filter = audioCtx.createBiquadFilter();
            filter.type = "peaking";
            filter.frequency.value = freq;
            filter.Q.value = 1;
            filter.gain.value = parseFloat(eqSliders[index].value);
            
            lastNode.connect(filter);
            lastNode = filter;
            eqNodes.push(filter);
        });
        
        lastNode.connect(analyser);
    }

    function updateEqualizer() {
        if (!eqNodes.length) return;
        
        const eqSliders = [eqSub, eqLow1, eqLow2, eqLowMid, eqMid, eqHighMid1, eqHighMid2, eqHigh1, eqHigh2];
        
        eqSliders.forEach((slider, index) => {
            if (eqNodes[index]) {
                eqNodes[index].gain.value = parseFloat(slider.value);
            }
        });
        
        updateEqValues();
    }

    function updateEqValues() {
        eqSubValue.textContent = `${eqSub.value}dB`;
        eqLow1Value.textContent = `${eqLow1.value}dB`;
        eqLow2Value.textContent = `${eqLow2.value}dB`;
        eqLowMidValue.textContent = `${eqLowMid.value}dB`;
        eqMidValue.textContent = `${eqMid.value}dB`;
        eqHighMid1Value.textContent = `${eqHighMid1.value}dB`;
        eqHighMid2Value.textContent = `${eqHighMid2.value}dB`;
        eqHigh1Value.textContent = `${eqHigh1.value}dB`;
        eqHigh2Value.textContent = `${eqHigh2.value}dB`;
    }

    function applyPreset(preset) {
        const presets = {
            flat: [0, 0, 0, 0, 0, 0, 0, 0, 0],
            bass: [6, 4, 2, 0, -1, -2, -2, -2, -2],
            treble: [-2, -2, -2, -2, -1, 0, 2, 4, 6],
            vocal: [-2, -1, 0, 1, 2, 3, 2, 1, 0],
            rock: [4, 3, 2, 0, 0, 0, 2, 3, 4],
            jazz: [2, 1, 0, 0, 0, 0, 0, 1, 2],
            classical: [0, 0, 0, 0, 0, 0, 0, 0, 0],
            electronic: [4, 3, 2, 0, -1, 0, 2, 3, 4]
        };
        
        const values = presets[preset] || presets.flat;
        const eqSliders = [eqSub, eqLow1, eqLow2, eqLowMid, eqMid, eqHighMid1, eqHighMid2, eqHigh1, eqHigh2];
        
        eqSliders.forEach((slider, index) => {
            slider.value = values[index];
        });
        
        updateEqualizer();
        
        presetButtons.forEach(btn => {
            if (btn.dataset.preset === preset) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    function startVisualizer() {
        if (!analyser) return;
        
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        const timeDataArray = new Uint8Array(bufferLength);
        
        function draw() {
            animationId = requestAnimationFrame(draw);
            
            analyser.getByteFrequencyData(dataArray);
            analyser.getByteTimeDomainData(timeDataArray);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            switch(vizType) {
                case 'bars':
                    drawBars(dataArray, bufferLength);
                    break;
                case 'wave':
                    drawWave(timeDataArray, bufferLength);
                    break;
                case 'circle':
                    drawCircle(dataArray, bufferLength);
                    break;
                case 'spectrum':
                    drawSpectrum(dataArray, bufferLength);
                    break;
            }
        }
        
        draw();
    }

    function stopVisualizer() {
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawBars(dataArray, bufferLength) {
        const barWidth = (canvas.width / bufferLength) * 2.5;
        let barHeight;
        let x = 0;
        
        for(let i = 0; i < bufferLength; i++) {
            barHeight = (dataArray[i] / 255) * canvas.height;
            
            const intensity = dataArray[i] / 255;
            const hue = 200 + (intensity * 160);
            ctx.fillStyle = `hsl(${hue}, 100%, ${50 + intensity * 25}%)`;
            ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
            
            x += barWidth + 1;
        }
    }

    function drawWave(timeDataArray, bufferLength) {
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#00a884';
        ctx.beginPath();
        
        const sliceWidth = canvas.width / bufferLength;
        let x = 0;
        
        wavePhase += 0.05;
        
        for(let i = 0; i < bufferLength; i++) {
            const v = timeDataArray[i] / 128.0;
            const y = (v * canvas.height / 2) + Math.sin(x * 0.01 + wavePhase) * 5;
            
            if(i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
            
            x += sliceWidth;
        }
        
        ctx.stroke();
        
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#00a884';
        ctx.stroke();
        ctx.shadowBlur = 0;
    }

    function drawCircle(dataArray, bufferLength) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = Math.min(centerX, centerY) * 0.6;
        
        ctx.beginPath();
        
        for(let i = 0; i < bufferLength; i++) {
            const angle = (i * 2 * Math.PI) / bufferLength;
            const value = dataArray[i] / 255;
            const pointRadius = value * radius * 0.8;
            
            const x = centerX + Math.cos(angle) * (radius + pointRadius);
            const y = centerY + Math.sin(angle) * (radius + pointRadius);
            
            if(i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        
        ctx.closePath();
        ctx.strokeStyle = '#00a884';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
        gradient.addColorStop(0, 'rgba(0, 168, 132, 0.3)');
        gradient.addColorStop(1, 'rgba(0, 168, 132, 0.1)');
        ctx.fillStyle = gradient;
        ctx.fill();
    }

    function drawSpectrum(dataArray, bufferLength) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const maxRadius = Math.min(centerX, centerY) * 0.8;
        
        for (let i = 0; i < bufferLength; i += 2) {
            const value = dataArray[i] / 255;
            const angle = (i * 2 * Math.PI) / bufferLength;
            const barHeight = value * maxRadius * 0.5;
            const barWidth = 2;
            
            const x1 = centerX + Math.cos(angle) * maxRadius;
            const y1 = centerY + Math.sin(angle) * maxRadius;
            const x2 = centerX + Math.cos(angle) * (maxRadius + barHeight);
            const y2 = centerY + Math.sin(angle) * (maxRadius + barHeight);
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineWidth = barWidth;
            
            const hue = i / bufferLength * 360;
            ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.stroke();
        }
    }

    function updateConnectionStats() {
        if (!audio.src || audio.paused) return;
        
        const bitrate = 128 + Math.floor(Math.random() * 64);
        const bufferHealth = Math.max(0, Math.min(100, 100 - (audio.buffered.length ? 0 : 50)));
        const listeners = 50 + Math.floor(Math.random() * 150);
        
        bitrateStat.textContent = `Bitrate: ${bitrate} kbps`;
        bufferStat.textContent = `Buffer: ${bufferHealth}%`;
        qualityStat.textContent = `Qualit√©: Excellent`;
        listenersCount.textContent = `üë• ${listeners}`;
        bitrateDisplay.textContent = `${bitrate} kbps`;
    }

    function startSleepTimer(minutes) {
        if (sleepTimer) {
            clearTimeout(sleepTimer);
        }
        
        const milliseconds = minutes * 60 * 1000;
        sleepTimer = setTimeout(() => {
            audio.pause();
            setStatus("Minuterie - Lecture arr√™t√©e", "warning");
            sleepTimerDisplay.textContent = "Termin√©e";
            alert(`Minuterie de veille: La lecture a √©t√© arr√™t√©e apr√®s ${minutes} minutes.`);
        }, milliseconds);
        
        const endTime = new Date(Date.now() + milliseconds);
        sleepTimerDisplay.textContent = `Active - ${endTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        
        sleepTimerBtns.forEach(btn => {
            if (parseInt(btn.dataset.minutes) === minutes) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    function stopSleepTimerFunc() {
        if (sleepTimer) {
            clearTimeout(sleepTimer);
            sleepTimer = null;
        }
        sleepTimerDisplay.textContent = "D√©sactiv√©e";
        sleepTimerBtns.forEach(btn => btn.classList.remove('active'));
    }

    function toggleMute() {
        if (isMuted) {
            audio.volume = originalVolume;
            volumeSlider.value = originalVolume;
            volumeValue.textContent = Math.round(originalVolume * 100) + '%';
            muteBtn.innerHTML = '<span>üîá</span> Mute';
            setStatus("Son r√©tabli", "success");
        } else {
            originalVolume = audio.volume;
            audio.volume = 0;
            volumeSlider.value = 0;
            volumeValue.textContent = '0%';
            muteBtn.innerHTML = '<span>üîä</span> Unmute';
            setStatus("Son coup√©", "warning");
        }
        isMuted = !isMuted;
    }

    function toggleBassBoost() {
        isBassBoost = !isBassBoost;
        
        if (isBassBoost) {
            eqSub.value = 8;
            eqLow1.value = 6;
            eqLow2.value = 4;
            boostBtn.classList.add('active');
            setStatus("Boost des basses activ√©", "success");
        } else {
            eqSub.value = 0;
            eqLow1.value = 0;
            eqLow2.value = 0;
            boostBtn.classList.remove('active');
            setStatus("Boost des basses d√©sactiv√©", "normal");
        }
        updateEqualizer();
    }

    function restartStream() {
        if (!audio.src) return;
        
        const wasPlaying = !audio.paused;
        const currentSrc = audio.src;
        
        audio.pause();
        audio.src = '';
        audio.src = currentSrc;
        
        if (wasPlaying) {
            audio.play().catch(console.error);
        }
        
        setStatus("Flux red√©marr√©", "success");
    }

    // Ajuster la taille du canvas
    function resizeCanvas() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        
        ctx.scale(dpr, dpr);
        canvas.style.width = `${rect.width}px`;
        canvas.style.height = `${rect.height}px`;
    }

    // Initialisation au chargement
    document.addEventListener('DOMContentLoaded', function() {
        // Redimensionner le canvas
        resizeCanvas();
        
        // V√©rifier l'√©tat des sections masqu√©es
        const isEqVisible = androidStorage.getItem('radio_eq_visible') !== false;
        const isRecordingVisible = androidStorage.getItem('radio_recording_visible') !== false;
        const isSleepTimerVisible = androidStorage.getItem('radio_sleep_timer_visible') !== false;

        if (!isEqVisible) {
            equalizerBlock.classList.add('collapsed');
            eqToggle.textContent = 'Afficher';
        }
        if (!isRecordingVisible) {
            recordingBlock.classList.add('collapsed');
            recordingToggle.textContent = 'Afficher';
        }
        if (!isSleepTimerVisible) {
            sleepTimerBlock.classList.add('collapsed');
            sleepTimerToggle.textContent = 'Afficher';
        }

        // Initialiser la radio
        initializeRadio();
        updateRecordingsList();
        
        // Initialiser les valeurs
        volumeValue.textContent = Math.round(volumeSlider.value * 100) + '%';
        presetButtons[0].classList.add('active');
        updateEqValues();
    });

    // √âv√©nements
    playBtn.addEventListener('click', togglePlay);

    volumeSlider.addEventListener('input', () => {
        audio.volume = volumeSlider.value;
        volumeValue.textContent = Math.round(volumeSlider.value * 100) + '%';
    });

    vizButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            vizButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            vizType = btn.dataset.viz;
        });
    });

    recordBtn.addEventListener('click', function() {
        if (!mediaRecorder || mediaRecorder.state === 'inactive') {
            startRecording();
        } else {
            stopRecording();
        }
    });

    eqToggle.addEventListener('click', () => {
        toggleSection(equalizerBlock, eqToggle, 'radio_eq_visible');
    });

    recordingToggle.addEventListener('click', () => {
        toggleSection(recordingBlock, recordingToggle, 'radio_recording_visible');
    });

    sleepTimerToggle.addEventListener('click', () => {
        toggleSection(sleepTimerBlock, sleepTimerToggle, 'radio_sleep_timer_visible');
    });

    recordingsBtn.addEventListener('click', () => {
        updateRecordingsList();
        recordingsModal.style.display = 'flex';
    });

    closeRecordings.addEventListener('click', () => {
        recordingsModal.style.display = 'none';
    });

    muteBtn.addEventListener('click', toggleMute);
    replayBtn.addEventListener('click', restartStream);
    boostBtn.addEventListener('click', toggleBassBoost);

    sleepTimerBtns.forEach(btn => {
        if (btn.id !== 'stopSleepTimer') {
            btn.addEventListener('click', () => {
                startSleepTimer(parseInt(btn.dataset.minutes));
            });
        }
    });

    stopSleepTimer.addEventListener('click', stopSleepTimerFunc);

    // √âv√©nements √©galiseur
    const eqSliders = [eqSub, eqLow1, eqLow2, eqLowMid, eqMid, eqHighMid1, eqHighMid2, eqHigh1, eqHigh2];
    eqSliders.forEach(slider => {
        slider.addEventListener('input', () => {
            updateEqualizer();
        });
    });

    presetButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            applyPreset(btn.dataset.preset);
        });
    });

    // √âv√©nements audio
    audio.addEventListener('loadstart', () => {
        setStatus("Chargement du flux Radio JunTech...", "warning");
    });

    audio.addEventListener('canplay', () => {
        setStatus("Radio JunTech pr√™te √† √©couter", "success");
    });

    audio.addEventListener('playing', () => {
        setStatus("Lecture en cours - Radio JunTech", "live");
    });

    audio.addEventListener('error', (e) => {
        console.error("Erreur audio:", e);
        setStatus("Erreur de connexion √† Radio JunTech", "error");
    });

    audio.addEventListener('waiting', () => {
        setStatus("Mise en m√©moire tampon...", "warning");
    });

    // Redimensionnement du canvas
    window.addEventListener('resize', resizeCanvas);

    // Mettre √† jour les statistiques p√©riodiquement
    setInterval(updateConnectionStats, 5000);
</script>

</body>
</html>